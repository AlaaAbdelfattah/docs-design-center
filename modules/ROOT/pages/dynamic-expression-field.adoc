= Create an Expression Dynamically
:imagesdir: ../assets/images

In text fields that are in the cards in a flow, you can create DataWeave expressions by dragging and dropping payload elements, variables, and attributes. You can also create custom DataWeave expressions by dragging

== About this task




When the input of your card is known by Datasense, the card displays a list of every element of your payload, every variable, and every attribute. You can drag and drop these expression blocks into your field to compose different expressions without writing a single line of DataWeave.

At the top of the list appears an entry named "Custom Expression". You can click it and drop it into a text field if you want to compose a DataWeave expression within that field.

image::logger-with-list.png[]

== Before you begin

Payload elements, variables, and attributes that appear in the list in a card are passed in by the preceding card. Default payloads and attributes, if there are any attributes, always appear without any action required from you. However, before a list of elements for the payload of a message can appear, you must define a custom data type for the output payload in the previous card. (If the previous card is a Set Variable card, you must define the custom data type for the output payload in the card before that). Before a variable can appear in the list, you must define a variable in a previous card.

For example, suppose you wanted a Logger to parse the output payload of an HTTP Listener and then to log messages that contain payload data. You would set up this simple flow, with `/example` being the endpoint for the HTTP Listener:

image::simple-flow-before-you-begin.png[]

The list in the Logger card looks like the list that is highlighted in blue in this image:

image::logger-initial-list.png[]

Next, suppose you create a custom data type for the output payload of the HTTP Listener, using this JSON example:

[source,JSON,linenums]
----
{
	"firstName": "Sancho",
	"lastName": "Panza"
}
----

When you reopen the Logger card after a moment (giving a brief amount of time to Design Center to recognize the custom data type in the flow), the `payload` entry in the list is now replaced by `firstName` and `lastName`.

image::logger-with-list.png[]

If you want to use a variable in an expression in the Logger card, you could add a Set Variable card just before it:

image::first-name-basis.png[]

== Procedure

* Add a block to a field by...  Note that when you drag a block, the card highlights the borders of the fields that you can drop it into.
* Remove a block from a field by clicking in the field immediately after the block and typing your Delete or Backspace key.

== Example: Creating a simple expression dynamically

This example uses a flow in which an HTTP Listener receives a POST request that contains a JSON payload. The HTTP Listener then passes the payload to a Logger. This payload contains a person's first and last name:


=== Procedure

. In a new Mule application project, add an HTTP Listener card for the trigger of a new flow.
. Open the card and set the path to `/example`.
. Set up the data type for the output of this card.
.. Go to the *Output* section.
.. Next to the *Data Type* drop-down menu, click *Add*.
.. In the *Name* field, specify any name you like for the data type.
.. Select *JSON* from the *Format* drop-down menu.
.. Select *From Example* in the *Type* field and paste in the following JSON example for your payload.
+
[source,JSON,linenums]
----
{
	"firstName": "Sancho",
	"lastName": "Panza"
}
----
.. Click *Save*.
. Add a Logger card after the HTTP Listener card and then open it.
+
*Result:* The elements of the payload -- `payload.firstName` and `payload.lastName`-- and the attributes from the HTTP Listener are listed on the right side of the card. If the message next to the *Run* button at the top of the canvas is "Creating...", you must wait until the message changes before you will see the elements listed.
. Specify a message for the Logger to include in the log whenever it receives a payload.
.. In the *Message* field, type ```Hello, ```.
.. Click the payload element `payload.firstName` and drag it into the *Message* field.
. Run the application by clicking the *Run* button at the top of the canvas.
. Copy the URL for the application by clicking on it to the right of the *Run* button.
. In Postman or cURL, post a JSON message to the `/example` endpoint, using the same format as the example you specified in the HTTP Listener card.

=== Result

After you post the message, return to your flow in Design Center, open the log, and look for your message.

=== What to do next

Try adding a Set Variable card after the HTTP Listener card, creating a variable that stores the value of `payload.firstName`, and then changing the message in the Logger to use the variable instead of the payload element. In the Logger card, the variable will appear in the list on the right. You can delete the payload element from the message and then drag in the variable.


== Example: Creating a complex expression

Additionally, you can drag and drop the *Custom Expression* block to create more complex expressions.

Assume you want to log a greeting for both of users. Since your _candidates_ variable is an array, DataWeave won't be able to concatenate it next to a _Hello_ string. You need to use a custom expression to be able to log a proper greeting for both your candidates.

. Open a logger card, and drag the *Custom Expression* block.
+
image::dataweave-expression-editor-e725f.png[]
. Double-click on it to open the custom expression field, and type the following DataWeave expression:
+
[source,DataWeave,linenums]
----
"Hello " ++ (joinBy(vars.candidates, ' and '))
----
. Click *OK*.

Note that the field automatically understood the concatenation between your _Hello_ and the rest of your custom expression.

image::dataweave-expression-editor-f1ef5.png[]

== See Also

* xref:function-editor-concept.adoc[Function Editor]
* xref:to-create-and-populate-a-variable.adoc[About Creating Variables]
* xref:mule-runtime::dataweave-selectors.adoc[DataWeave Selectors]
