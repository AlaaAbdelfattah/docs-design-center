= Create an Expression Dynamically

In fields that are in the cards in a flow, you can create expressions by dragging and dropping payload elements, variables, and attributes.

== About this task


Whenever you need to configure a field that is in a card, you can use dynamic and static values that are obtained from your flow when your Mule application is running.

When the input of your card is known by Datasense, the card displays a list of blocks for every element of your payload, every variable, and every attribute. You can drag and drop these expression blocks into your field to compose different expressions without writing a single line of code.

== Before you begin

Before a list of elements for the payload of a message can appear, a payload must be defined in the previous card.

== Procedure

* Add a block to a field by...
* Remove a block from a field by clicking in the field immediately after the block and typing your Delete or Backspace key.

== Result




== Example: Creating a simple expression

Starting with a simple example, let's create a flow where your HTTP Listener receives a POST request with a JSON payload containing a candidate's first and last name. A payload like this:

[source,JSON,linenums]
----
{
	"firstName": "Michael",
	"lastName": "Patrick"
}
----

The editor needs Datasense metadata to generate the payload, variables, and attributes suggestions.

When creating your HTTP Listener, you need to set up the output type of your card to this example.

. Create a new HTTP Listener trigger and go to the *Output* tab.
. Next to the *Data Type* drop-down menu, click *Add*.
.. In the *Name* field use _Name_ as an identifier.
.. Select *JSON* from the *Format* drop-down menu.
.. Select *From Example* in the *Type* field and use the JSON sample above.
+
image::dataweave-expression-editor-629d7.png[]
. Click *Save*.

Now that you defined the output type of your trigger, Datasense can understand your payload's structure so that the card displays the proper blocks. +
For example, create a Logger card next to your HTTP Listener, and observe how the payload and attributes values are displayed in the right panel:

image::dataweave-expression-editor-3e5cd.png[]

The card automatically picks up both your payload's values: `payload.firstName` and `payload.lastName`. +
You can, for example, log a greeting to your candidate typing _Hello_ and drag the *firstName* block next to it:

image::dataweave-expression-editor-e5dd8.png[]
//_TODO: Add borders to images

Note that when picking up an expression block, the card highlights the borders of the fields where you can drop the expression:

image::dataweave-expression-editor-828db.png[]

The card also picks up your message's variables. +
For example, assume that your flow receives a payload with more than just one name:

[source,java,linenums]
----
[{
        "firstName": "Gunther",
        "lastName": "Govan",
},
{
        "firstName": "Michael",
        "lastName": "Patrick",
}]
----

And you want to log all the candidate's first names and you want to send that data to a variable for later reuse.

. Add a *Set Variable* card next to your trigger.
. Name your variable *candidates*, and use a DataWeave multi-value selector to capture all candidate's names:
+
[source,DataWeave,linenums]
----
payload.*firstName
----
+
image::dataweave-expression-editor-4e7fd.png[]
. You can then change the logger components to log your newly created variable.
+
image::dataweave-expression-editor-c2c3c.png[]

=== Example: Creating a complex expression

Additionally, you can drag and drop the *Custom Expression* block to create more complex expressions.

Assume you want to log a greeting for both of users. Since your _candidates_ variable is an array, DataWeave won't be able to concatenate it next to a _Hello_ string. You need to use a custom expression to be able to log a proper greeting for both your candidates.

. Open a logger card, and drag the *Custom Expression* block.
+
image::dataweave-expression-editor-e725f.png[]
. Double-click on it to open the custom expression field, and type the following DataWeave expression:
+
[source,DataWeave,linenums]
----
"Hello " ++ (joinBy(vars.candidates, ' and '))
----
. Click *OK*.

Note that the field automatically understood the concatenation between your _Hello_ and the rest of your custom expression.

image::dataweave-expression-editor-f1ef5.png[]

== See Also

* xref:function-editor-concept.adoc[Function Editor]
* xref:to-create-and-populate-a-variable.adoc[About Creating Variables]
* xref:mule-runtime::dataweave-selectors.adoc[DataWeave Selectors]
